#!/usr/bin/env python3
"""
–°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–π —É—Ä–æ–∫ —Å –±–æ–≥–∞—Ç—ã–º —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º
"""

import os
import sys
sys.path.append('/app/backend')

from supabase_client import supabase_client
import asyncio

# –ö–æ–Ω—Ç–µ–Ω—Ç —É—Ä–æ–∫–∞ —Å —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º Markdown
FORMATTED_LESSON_CONTENT = """# –ü–µ—Ä–≤—ã–π —É—Ä–æ–∫ –•–∞—Ç–∏–º–∞ –ê—Å–∞–Ω–∞: –û –±–ª–∏–∑–∫–∏—Ö –∏ –±–ª–∞–≥–∏—Ö –¥–µ—è–Ω–∏—è—Ö

## –í–≤–µ–¥–µ–Ω–∏–µ

**–•–∞—Ç–∏–º –ê—Å–∞–Ω** ‚Äî –≤—ã–¥–∞—é—â–∏–π—Å—è –º—ã—Å–ª–∏—Ç–µ–ª—å –∏ —É—á–∏—Ç–µ–ª—å. –í —ç—Ç–æ–º —É—Ä–æ–∫–µ –º—ã –∏–∑—É—á–∏–º –µ–≥–æ –ø–µ—Ä–≤–æ–µ –≤–∞–∂–Ω–æ–µ –Ω–∞—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –æ *–±–ª–∏–∑–∫–∏—Ö –∏ –±–ª–∞–≥–∏—Ö –¥–µ—è–Ω–∏—è—Ö*.

---

### –ò—Å—Ç–æ—Ä–∏—è –≤—Å—Ç—Ä–µ—á–∏

–ò—Å—Ç–æ—Ä–∏—è –æ –•–∞—Ç–∏–º–µ –ê—Å–∞–Ω–µ –∏ –≤–æ—Å—å–º–∏ —É—Ä–æ–∫–∞—Ö. –í—Å—Ç—Ä–µ—á–∞ —É—á–∏—Ç–µ–ª—è –∏ —É—á–µ–Ω–∏–∫–∞ –±—ã–ª —É—á–µ–Ω—ã–π, –∫–æ—Ç–æ—Ä–æ–≥–æ –∑–≤–∞–ª–∏ –•–∞—Ç–∏–º –ê—Å–∞–Ω. –£ –Ω–µ–≥–æ –±—ã–ª —É—á–∏—Ç–µ–ª—å –ø–æ –∏–º–µ–Ω–∏ *–®–∞–∫–∏–∫ –ë–∞–ª—Ö–∏*.

> –û–¥–Ω–∞–∂–¥—ã –Ω–∞—Å—Ç–∞–≤–Ω–∏–∫ —Å–ø—Ä–æ—Å–∏–ª —Å–≤–æ–µ–≥–æ —É—á–µ–Ω–∏–∫–∞: ‚Äî –¢—ã –Ω–∞ –ø—Ä–æ—Ç—è–∂–µ–Ω–∏–∏ —Ç—Ä–∏–¥—Ü–∞—Ç–∏ –ª–µ—Ç –Ω–∞—Ö–æ–¥–∏–ª—Å—è —Ä—è–¥–æ–º —Å–æ –º–Ω–æ–π. –ö–∞–∫—É—é –ø–æ–ª—å–∑—É —Ç—ã –∏–∑–≤–ª–µ–∫ –∑–∞ —ç—Ç–∏ –≥–æ–¥—ã?

**–û—Ç–≤–µ—Ç –•–∞—Ç–∏–º–∞-–ê—Å–∞–Ω–∞:**
‚Äî –Ø –ø—Ä–∏–æ–±—Ä–µ–ª –≤–æ—Å–µ–º—å –ø–æ–ª–µ–∑–Ω—ã—Ö –≤–µ—â–µ–π. –ò —ç—Ç–æ–≥–æ –º–Ω–µ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ, –ø–æ—Ç–æ–º—É —á—Ç–æ –Ω–∞–¥–µ—é—Å—å, —á—Ç–æ —ç—Ç–æ —Å—Ç–∞–Ω–µ—Ç –ø—Ä–∏—á–∏–Ω–æ–π –º–æ–µ–≥–æ —Å–ø–∞—Å–µ–Ω–∏—è.

### –ü–µ—Ä–≤—ã–π —É—Ä–æ–∫: –û –±–ª–∏–∑–∫–∏—Ö –∏ –±–ª–∞–≥–∏—Ö –¥–µ—è–Ω–∏—è—Ö

–•–∞—Ç–∏–º —Å–∫–∞–∑–∞–ª:

> **–ü–µ—Ä–≤–æ–µ.** –Ø –Ω–∞–±–ª—é–¥–∞–ª –∑–∞ –ª—é–¥—å–º–∏ –∏ –≤–∏–¥–µ–ª, —á—Ç–æ —É –∫–∞–∂–¥–æ–≥–æ –µ—Å—Ç—å —Ç–æ—Ç, –∫–æ–≥–æ –æ–Ω —Ü–µ–Ω–∏—Ç, –ª—é–±–∏—Ç, —É–≤–∞–∂–∞–µ—Ç, –∫ –∫–æ–º—É –ø—Ä–∏–≤—è–∑–∞–Ω ‚Äî –±—É–¥—å —Ç–æ –¥–µ—Ç–∏, —Ä–æ–¥–∏—Ç–µ–ª–∏, —Å–µ–º—å—è –∏–ª–∏ –ª—é–±–æ–π –±–ª–∏–∑–∫–∏–π —á–µ–ª–æ–≤–µ–∫.

#### –ö–ª—é—á–µ–≤—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã:

1. **–ü—Ä–∏–≤—è–∑–∞–Ω–Ω–æ—Å—Ç–∏ –∫ –±–ª–∏–∑–∫–∏–º** ‚Äî –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ —á—É–≤—Å—Ç–≤–æ —á–µ–ª–æ–≤–µ–∫–∞
2. **–í–∑–∞–∏–º–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞** ‚Äî –æ—Å–Ω–æ–≤–∞ –∫—Ä–µ–ø–∫–∏—Ö –æ—Ç–Ω–æ—à–µ–Ω–∏–π  
3. **–ë–ª–∞–≥–∏–µ –¥–µ–ª–∞** ‚Äî –ø—É—Ç—å –∫ –¥—É—Ö–æ–≤–Ω–æ–º—É —Ä–æ—Å–≤–∏—Ç–∏—é

#### –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ:

- –°–æ–≤–µ—Ä—à–∞–π—Ç–µ –¥–æ–±—Ä–æ –¥–ª—è –±–ª–∏–∑–∫–∏—Ö –ª—é–¥–µ–π
- –ü–æ–º–Ω–∏—Ç–µ –æ —Å–≤–æ–µ–º –ø–æ–ª–æ–∂–µ–Ω–∏–∏ –ø–æ—Å–ª–µ —Å–º–µ—Ä—Ç–∏
- –ò—â–∏—Ç–µ –ø—É—Ç—å —Å–ø–∞—Å–µ–Ω–∏—è —á–µ—Ä–µ–∑ —Å–≤–æ–∏ –ø–æ—Å—Ç—É–ø–∫–∏

---

## –ú—É–¥—Ä–æ—Å—Ç—å —É—á–∏—Ç–µ–ª—è

*¬´–¢–æ—Ç, –∫—Ç–æ –≤–æ—à–µ–ª –≤ –º–æ–≥–∏–ª—É –±–µ–∑ –±–ª–∞–≥–∏—Ö –¥–µ—è–Ω–∏–π, –ø–æ–¥–æ–±–µ–Ω —Ç–æ–º—É, –∫—Ç–æ –≤–æ—à–µ–ª –≤ –æ–∫–µ–∞–Ω –±–µ–∑ –∫–æ—Ä–∞–±–ª—è¬ª.*

**–í–∞–∂–Ω–æ –ø–æ–º–Ω–∏—Ç—å:** –¥–æ–±—Ä—ã–µ –¥–µ–ª–∞ –∏–∑–±–∞–≤—è—Ç –æ—Ç –æ–¥–∏–Ω–æ—á–µ—Å—Ç–≤–∞ –≤ –º–æ–≥–∏–ª–µ –∏ —Å–æ—Ö—Ä–∞–Ω—è—Ç –æ—Ç –º—É—á–µ–Ω–∏–π.

### –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–ü–æ—ç—Ç–æ–º—É, —Å–æ–≤–µ—Ä—à–∞—è –¥–æ–±—Ä–æ, –Ω—É–∂–Ω–æ –¥–µ–ª–∞—Ç—å —ç—Ç–æ –∏—Å–∫—Ä–µ–Ω–Ω–µ, –ø–æ–º–Ω—è –æ —Å–≤–æ–µ–º –ø–æ–ª–æ–∂–µ–Ω–∏–∏ –ø–æ—Å–ª–µ —Å–º–µ—Ä—Ç–∏.

---

*–õ–∏—Ü–µ–º–µ—Ä–Ω—ã–µ –ø–æ—Å—Ç—É–ø–∫–∏, —Å–¥–µ–ª–∞–Ω–Ω—ã–µ —Ä–∞–¥–∏ –ø–æ—Ö–≤–∞–ª—ã –∏–ª–∏ –≤–Ω–∏–º–∞–Ω–∏—è –ª—é–¥–µ–π, –≤ –∑–∞–≥—Ä–æ–±–Ω–æ–π –∂–∏–∑–Ω–∏ –Ω–µ –ø–æ–º–æ–≥—É—Ç.*"""

async def create_formatted_lesson():
    """–°–æ–∑–¥–∞—Ç—å —É—Ä–æ–∫ —Å —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–º —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ–º"""
    try:
        print("üé® –°–æ–∑–¥–∞–µ–º —É—Ä–æ–∫ —Å –±–æ–≥–∞—Ç—ã–º —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º...")
        
        # –ü–æ–ª—É—á–∞–µ–º –ø–µ—Ä–≤—ã–π –¥–æ—Å—Ç—É–ø–Ω—ã–π –∫—É—Ä—Å
        courses = await supabase_client.get_records("courses", limit=1)
        if not courses:
            print("‚ùå –ö—É—Ä—Å—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã")
            return
            
        course = courses[0]
        print(f"üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º –∫—É—Ä—Å: {course['title']}")
        
        # –°–æ–∑–¥–∞–µ–º —É—Ä–æ–∫ —Å —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–º —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ–º
        lesson_data = {
            "course_id": course["id"],
            "title": "–ü–µ—Ä–≤—ã–π —É—Ä–æ–∫ –•–∞—Ç–∏–º–∞ –ê—Å–∞–Ω–∞: –û –±–ª–∏–∑–∫–∏—Ö –∏ –±–ª–∞–≥–∏—Ö –¥–µ—è–Ω–∏—è—Ö",
            "description": "–ò–∑—É—á–µ–Ω–∏–µ –ø–µ—Ä–≤–æ–≥–æ —É—Ä–æ–∫–∞ –≤—ã–¥–∞—é—â–µ–≥–æ—Å—è –º—ã—Å–ª–∏—Ç–µ–ª—è –æ –≤–∞–∂–Ω–æ—Å—Ç–∏ –±–ª–∞–≥–∏—Ö –¥–µ–ª –∏ –ø—Ä–∏–≤—è–∑–∞–Ω–Ω–æ—Å—Ç–∏ –∫ –±–ª–∏–∑–∫–∏–º.",
            "content": FORMATTED_LESSON_CONTENT,
            "lesson_type": "text",
            "order": 999,  # –ü–æ—Å—Ç–∞–≤–∏–º –≤ –∫–æ–Ω–µ—Ü, —á—Ç–æ–±—ã –Ω–µ –º–µ—à–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º —É—Ä–æ–∫–∞–º
            "estimated_duration_minutes": 25,
            "is_published": True,
            "created_at": "2025-08-12T20:00:00Z",
            "updated_at": "2025-08-12T20:00:00Z"
        }
        
        lesson = await supabase_client.create_record("lessons", lesson_data)
        print(f"‚úÖ –£—Ä–æ–∫ —Å–æ–∑–¥–∞–Ω —Å ID: {lesson['id']}")
        print(f"üéØ –ù–∞–∑–≤–∞–Ω–∏–µ: {lesson['title']}")
        print(f"üìù –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ –≤–∫–ª—é—á–∞–µ—Ç: –∑–∞–≥–æ–ª–æ–≤–∫–∏, –∂–∏—Ä–Ω—ã–π —Ç–µ–∫—Å—Ç, –∫—É—Ä—Å–∏–≤, —Å–ø–∏—Å–∫–∏, —Ü–∏—Ç–∞—Ç—ã, —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–∏")
        
        return lesson
        
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞: {e}")

if __name__ == "__main__":
    asyncio.run(create_formatted_lesson())